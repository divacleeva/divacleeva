<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Trading Chart Analyzer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .controls {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            margin-bottom: 20px;
        }
        
        .input-group {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .input-field {
            padding: 12px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            min-width: 120px;
        }
        
        .input-field:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            padding: 12px 25px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .api-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .api-input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 0;
            box-shadow: 0 8px 32px rgba(0,0,0,0.15);
            margin-bottom: 20px;
            min-height: 600px;
            overflow: hidden;
        }
        
        .analysis-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
        }
        
        .spinner {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .trade-summary {
            background: linear-gradient(135deg, #e8f5e8, #f0f8f0);
            border-left: 5px solid #4caf50;
            padding: 20px;
            border-radius: 8px;
            margin-top: 15px;
        }
        
        .error {
            background: linear-gradient(135deg, #ffe8e8, #fff0f0);
            border-left: 5px solid #f44336;
            padding: 20px;
            border-radius: 8px;
            color: #d32f2f;
        }
        
        .disclaimer {
            background: rgba(255, 193, 7, 0.1);
            border: 2px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            color: #856404;
            font-size: 14px;
        }

        .cors-info {
            background: rgba(33, 150, 243, 0.1);
            border: 2px solid #2196f3;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            color: #1565c0;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ AI Trading Chart Analyzer</h1>
            <p>Powered by TradingView & Google Gemini</p>
        </div>
        
        <div class="api-section">
            <h3>üîë Google Gemini API Key</h3>
            <p>Get your free API key from <a href="https://makersuite.google.com/app/apikey" target="_blank">Google AI Studio</a></p>
            <input type="password" id="apiKey" class="api-input" placeholder="Enter your Gemini API key...">
            <div class="cors-info">
                <strong>üí° Important:</strong> Due to browser security (CORS), this will work best when:
                <br>‚Ä¢ Deployed to GitHub Pages or a web server
                <br>‚Ä¢ Or use a CORS proxy like <code>https://cors-anywhere.herokuapp.com/</code>
                <br>‚Ä¢ For testing locally, try opening in Chrome with <code>--disable-web-security</code> flag
            </div>
        </div>
        
        <div class="controls">
            <div class="input-group">
                <input type="text" id="ticker" class="input-field" placeholder="Enter ticker (e.g., AAPL)" value="AAPL">
                <select id="timeframe" class="input-field">
                    <option value="1m">1 minute</option>
                    <option value="5m">5 minutes</option>
                    <option value="15m">15 minutes</option>
                    <option value="1h">1 hour</option>
                    <option value="4h">4 hours</option>
                    <option value="1d" selected>1 day</option>
                    <option value="1w">1 week</option>
                </select>
                <label><input type="checkbox" id="useCorsProxy" checked> Use CORS Proxy</label>
                <button id="analyzeBtn" class="btn">üîç Analyze Chart</button>
            </div>
        </div>
        
        <div class="chart-container">
            <div class="tradingview-widget-container">
                <div id="tradingview_chart"></div>
                <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-advanced-chart.js" async>
                {
                  "autosize": true,
                  "symbol": "NASDAQ:AAPL",
                  "interval": "D",
                  "timezone": "Etc/UTC",
                  "theme": "light",
                  "style": "1",
                  "locale": "en",
                  "enable_publishing": false,
                  "hide_top_toolbar": false,
                  "hide_legend": false,
                  "save_image": false,
                  "container_id": "tradingview_chart",
                  "studies": [
                    "RSI@tv-basicstudies",
                    "MACD@tv-basicstudies", 
                    "BB@tv-basicstudies"
                  ]
                }
                </script>
            </div>
        </div>
        
        <div class="analysis-container">
            <h3>üéØ AI Trading Analysis</h3>
            <div id="analysisResult">
                <p style="text-align: center; color: #888; padding: 20px;">
                    Enter a ticker symbol and click "Analyze Chart" to get AI-powered trading recommendations
                </p>
            </div>
        </div>
        
        <div class="disclaimer">
            <strong>‚ö†Ô∏è Important Disclaimer:</strong> This tool is for educational and research purposes only. The AI analysis should not be considered as financial advice. Always do your own research and consult with financial professionals before making trading decisions. Past performance does not guarantee future results.
        </div>
    </div>

    <script>
        function updateChartWidget(symbol, interval) {
            const container = document.querySelector('.tradingview-widget-container');
            container.innerHTML = `
                <div id="tradingview_chart"></div>
                <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-advanced-chart.js" async>
                {
                  "autosize": true,
                  "symbol": "NASDAQ:${symbol}",
                  "interval": "${interval}",
                  "timezone": "Etc/UTC",
                  "theme": "light",
                  "style": "1",
                  "locale": "en",
                  "enable_publishing": false,
                  "hide_top_toolbar": false,
                  "hide_legend": false,
                  "save_image": false,
                  "container_id": "tradingview_chart",
                  "studies": [
                    "RSI@tv-basicstudies",
                    "MACD@tv-basicstudies", 
                    "BB@tv-basicstudies"
                  ]
                }
                <\/script>
            `;
        }
        
        async function analyzeWithGemini(ticker, timeframe) {
            const apiKey = document.getElementById('apiKey').value.trim();
            const useCorsProxy = document.getElementById('useCorsProxy').checked;
            
            if (!apiKey) {
                throw new Error('Please enter your Google Gemini API key');
            }
            
            const prompt = `Analyze ${ticker} stock on ${timeframe} timeframe with RSI, MACD, and Bollinger Bands indicators.

Based on technical analysis principles, provide:

**1. Market Sentiment**: Bullish/Bearish/Neutral assessment
**2. Technical Levels**: Key support and resistance
**3. Trade Recommendation**: BUY/SELL/HOLD with reasoning  
**4. Entry Price**: Suggested entry point
**5. Stop Loss**: Risk management level
**6. Take Profit**: Target exit level
**7. Risk/Reward Ratio**: Calculate potential ratio
**8. Analysis Summary**: Key technical factors

Please format with clear headings and be specific with reasoning.`;
            
            let apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${apiKey}`;
            
            // Use CORS proxy if enabled
            if (useCorsProxy) {
                apiUrl = `https://cors-anywhere.herokuapp.com/${apiUrl}`;
            }
            
            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        ...(useCorsProxy && { 'X-Requested-With': 'XMLHttpRequest' })
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }]
                    })
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`API Error ${response.status}: ${errorText}`);
                }
                
                const data = await response.json();
                
                if (!data.candidates?.[0]?.content?.parts?.[0]?.text) {
                    throw new Error('Invalid API response format');
                }
                
                return data.candidates[0].content.parts[0].text;
                
            } catch (error) {
                console.error('API Error:', error);
                
                // Provide helpful error messages
                if (error.message.includes('Load failed') || error.message.includes('CORS')) {
                    throw new Error('CORS Error: Try enabling "Use CORS Proxy" or deploy to a web server like GitHub Pages');
                } else if (error.message.includes('403')) {
                    throw new Error('API Key Error: Check your Gemini API key is valid and has quota remaining');
                } else if (error.message.includes('429')) {
                    throw new Error('Rate Limit: Too many requests. Wait a moment and try again');
                } else {
                    throw error;
                }
            }
        }
        
        function formatAnalysis(analysis) {
            return analysis
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/\n\n/g, '</p><p>')
                .replace(/\n/g, '<br>')
                .replace(/^/, '<p>')
                .replace(/$/, '</p>');
        }
        
        document.getElementById('analyzeBtn').addEventListener('click', async function() {
            const ticker = document.getElementById('ticker').value.trim().toUpperCase();
            const timeframe = document.getElementById('timeframe').value;
            const resultDiv = document.getElementById('analysisResult');
            const btn = this;
            
            if (!ticker) {
                alert('Please enter a ticker symbol');
                return;
            }
            
            // Update chart
            updateChartWidget(ticker, timeframe);
            
            // Show loading
            btn.disabled = true;
            btn.textContent = 'üîÑ Analyzing...';
            resultDiv.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    AI is analyzing ${ticker} on ${timeframe} timeframe...
                </div>
            `;
            
            try {
                const analysis = await analyzeWithGemini(ticker, timeframe);
                
                resultDiv.innerHTML = `
                    <div class="trade-summary">
                        <h4>üìä AI Analysis for ${ticker} (${timeframe} timeframe)</h4>
                        <div style="margin-top: 15px;">
                            ${formatAnalysis(analysis)}
                        </div>
                        <div style="margin-top: 15px; font-size: 12px; color: #666;">
                            Analysis generated at ${new Date().toLocaleString()}
                        </div>
                    </div>
                `;
                
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        <strong>‚ùå Error:</strong> ${error.message}
                        <br><br>
                        <strong>Solutions:</strong>
                        <ul style="margin-top: 10px; margin-left: 20px;">
                            <li>‚úÖ Check "Use CORS Proxy" option above</li>
                            <li>üîó Deploy to GitHub Pages for best results</li>
                            <li>üîë Verify your Gemini API key is correct</li>
                            <li>‚è∞ Wait a moment if rate limited</li>
                        </ul>
                    </div>
                `;
            } finally {
                btn.disabled = false;
                btn.textContent = 'üîç Analyze Chart';
            }
        });
        
        // Enter key support
        document.getElementById('ticker').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('analyzeBtn').click();
            }
        });
    </script>
</body>
</html>
